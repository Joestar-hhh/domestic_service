<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cykj.domestic.mapper.CompanyMapper">


    <!--    登入-->
    <select id="companyLogin" parameterType="com.cykj.domestic.entity.Company"
            resultType="com.cykj.domestic.entity.Company">
             SELECT * FROM tb_company WHERE account=#{account}
    </select>

    <!--    平台端区域列表-->
    <select id="queryRegion" parameterType="com.cykj.domestic.entity.Company"
            resultType="com.cykj.domestic.entity.Company">
             SELECT B.region region,COUNT(A.region_id)regioncount,B.id regionId,MAX(A.join_time)joinTime
             FROM tb_region B LEFT JOIN tb_company A on A.region_id =B.id GROUP BY B.id LIMIT #{start},#{pageSize};
    </select>

    <!--    统计列表总数-->
    <select id="RegionCount" resultType="int" parameterType="com.cykj.domestic.entity.Company">
        select count(D.C) from
             (SELECT B.region,COUNT(*)C
                  FROM tb_region B LEFT JOIN tb_company A on A.region_id =B.id GROUP BY B.id)D;
    </select>

    <!--    删除区域-->
    <delete id="deleteRegion" parameterType="java.lang.String">
                DELETE FROM tb_region WHERE region=#{region}
    </delete>
    <!--    查询区域是否 存在-->
    <select id="selectRegionPresence" parameterType="java.lang.String" resultType="com.cykj.domestic.entity.Region">
                     SELECT * FROM tb_region WHERE region=#{region}
    </select>

    <!--    添加区域-->
    <insert id="insertRegion" parameterType="java.lang.String">
         INSERT INTO tb_region(region)VALUES(#{region})
    </insert>

    <!--    根据地区查看平台详情-->
    <select id="queryRegionCompany" parameterType="java.lang.String" resultType="com.cykj.domestic.entity.Company">
                    SELECT * FROM tb_company WHERE region_id=#{regionId}
    </select>


    <!--    服务类型数量统计-->
    <select id="serviceTypeStatistics" parameterType="java.lang.String" resultType="com.cykj.domestic.entity.Company">
        select st.type_name,count(c.service_relation_id) count_num from tb_service_type st
        left join tb_company c on st.id = c.service_relation_id
        group by st.id
    </select>
    <!--    区域数量统计-->
    <select id="regionStatistics" parameterType="java.lang.String" resultType="com.cykj.domestic.entity.Company">
        select r.region,count(c.region_id) count_num from tb_region r
        left join tb_company c on r.id = c.region_id
        group by r.id
    </select>
    <!--    按日期统计-->
    <select id="dateStatistics" parameterType="java.lang.String" resultType="com.cykj.domestic.entity.Company">
        select date(c.join_time) as join_day,count(c.id) count_num from tb_company c
        where c.join_time between date_format(#{startDate},'%Y%m%d')
        and date_format(#{endDate},'%Y%m%d') group by join_day;
    </select>



</mapper>